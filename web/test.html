<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalkRealm - API æ¸¬è©¦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .success {
            color: #28a745;
            font-weight: bold;
        }
        
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .status.online {
            background: #d4edda;
            color: #155724;
        }
        
        .status.offline {
            background: #f8d7da;
            color: #721c24;
        }
        
        input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
            margin-bottom: 10px;
            width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ TalkRealm API æ¸¬è©¦é é¢</h1>
        <p class="subtitle">æ¸¬è©¦å¾Œç«¯ API å’Œå‰ç«¯é€£æ¥</p>
        
        <div class="test-section">
            <h2>ğŸ“¡ ä¼ºæœå™¨ç‹€æ…‹</h2>
            <span id="server-status" class="status offline">é›¢ç·š</span>
            <br>
            <button onclick="checkHealth()">æª¢æŸ¥å¥åº·ç‹€æ…‹</button>
            <div id="health-result" class="result" style="display:none;"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ” ä½¿ç”¨è€…èªè­‰</h2>
            
            <div class="input-group">
                <label>æ¸¬è©¦å¸³è™Ÿè¨»å†Š</label>
                <input type="email" id="test-email" placeholder="email@example.com" value="test@talkrealm.com">
                <input type="text" id="test-username" placeholder="ä½¿ç”¨è€…åç¨±" value="testuser">
                <input type="password" id="test-password" placeholder="å¯†ç¢¼" value="test123456">
                <br>
                <button onclick="testRegister()">è¨»å†Šæ¸¬è©¦å¸³è™Ÿ</button>
            </div>
            
            <div class="input-group">
                <label>æ¸¬è©¦ç™»å…¥</label>
                <input type="email" id="login-email" placeholder="email@example.com" value="test@talkrealm.com">
                <input type="password" id="login-password" placeholder="å¯†ç¢¼" value="test123456">
                <br>
                <button onclick="testLogin()">ç™»å…¥</button>
            </div>
            
            <button onclick="testGetUser()" id="get-user-btn" disabled>å–å¾—ä½¿ç”¨è€…è³‡è¨Š</button>
            <div id="auth-result" class="result" style="display:none;"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ° ç¤¾ç¾¤åŠŸèƒ½</h2>
            <button onclick="testCreateGuild()" id="create-guild-btn" disabled>å»ºç«‹æ¸¬è©¦ç¤¾ç¾¤</button>
            <button onclick="testGetGuilds()" id="get-guilds-btn" disabled>å–å¾—ç¤¾ç¾¤åˆ—è¡¨</button>
            <div id="guild-result" class="result" style="display:none;"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”Œ WebSocket é€£æ¥</h2>
            <button onclick="testWebSocket()" id="ws-btn" disabled>æ¸¬è©¦ WebSocket</button>
            <button onclick="disconnectWebSocket()" id="ws-disconnect-btn" disabled>æ–·é–‹é€£æ¥</button>
            <div id="ws-result" class="result" style="display:none;"></div>
        </div>
        
        <div class="test-section">
            <h2>ğŸŒ å‰ç«¯é é¢</h2>
            <button onclick="openFrontend()">é–‹å•Ÿå‰ç«¯ä»‹é¢</button>
            <p style="margin-top: 10px; color: #666; font-size: 14px;">
                é»æ“ŠæŒ‰éˆ•å°‡åœ¨æ–°åˆ†é é–‹å•Ÿå®Œæ•´çš„ TalkRealm å‰ç«¯ä»‹é¢
            </p>
        </div>
    </div>
    
    <script>
        let token = null;
        let ws = null;
        const API_BASE = 'http://localhost:8080';
        const WS_BASE = 'ws://localhost:8080';
        
        // æª¢æŸ¥ä¼ºæœå™¨å¥åº·ç‹€æ…‹
        async function checkHealth() {
            const resultDiv = document.getElementById('health-result');
            const statusDiv = document.getElementById('server-status');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨æª¢æŸ¥...';
            
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">âœ“ ä¼ºæœå™¨é‹è¡Œä¸­</span>\n${JSON.stringify(data, null, 2)}`;
                statusDiv.className = 'status online';
                statusDiv.textContent = 'ç·šä¸Š';
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âœ— é€£æ¥å¤±æ•—</span>\n${error.message}`;
                statusDiv.className = 'status offline';
                statusDiv.textContent = 'é›¢ç·š';
            }
        }
        
        // æ¸¬è©¦è¨»å†Š
        async function testRegister() {
            const resultDiv = document.getElementById('auth-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨è¨»å†Š...';
            
            const email = document.getElementById('test-email').value;
            const username = document.getElementById('test-username').value;
            const password = document.getElementById('test-password').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/v1/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email,
                        username,
                        password,
                        nickname: username
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<span class="success">âœ“ è¨»å†ŠæˆåŠŸ</span>\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âœ— è¨»å†Šå¤±æ•—</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âœ— éŒ¯èª¤</span>\n${error.message}`;
            }
        }
        
        // æ¸¬è©¦ç™»å…¥
        async function testLogin() {
            const resultDiv = document.getElementById('auth-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨ç™»å…¥...';
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email,
                        password
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    token = data.token;
                    resultDiv.innerHTML = `<span class="success">âœ“ ç™»å…¥æˆåŠŸ</span>\nToken: ${token.substring(0, 50)}...\n\nä½¿ç”¨è€…è³‡è¨Š:\n${JSON.stringify(data.user, null, 2)}`;
                    
                    // å•Ÿç”¨éœ€è¦èªè­‰çš„æŒ‰éˆ•
                    document.getElementById('get-user-btn').disabled = false;
                    document.getElementById('create-guild-btn').disabled = false;
                    document.getElementById('get-guilds-btn').disabled = false;
                    document.getElementById('ws-btn').disabled = false;
                } else {
                    resultDiv.innerHTML = `<span class="error">âœ— ç™»å…¥å¤±æ•—</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âœ— éŒ¯èª¤</span>\n${error.message}`;
            }
        }
        
        // æ¸¬è©¦å–å¾—ä½¿ç”¨è€…è³‡è¨Š
        async function testGetUser() {
            const resultDiv = document.getElementById('auth-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨å–å¾—ä½¿ç”¨è€…è³‡è¨Š...';
            
            try {
                const response = await fetch(`${API_BASE}/api/v1/users/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<span class="success">âœ“ å–å¾—æˆåŠŸ</span>\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âœ— å–å¾—å¤±æ•—</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âœ— éŒ¯èª¤</span>\n${error.message}`;
            }
        }
        
        // æ¸¬è©¦å»ºç«‹ç¤¾ç¾¤
        async function testCreateGuild() {
            const resultDiv = document.getElementById('guild-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨å»ºç«‹ç¤¾ç¾¤...';
            
            const guildName = `æ¸¬è©¦ç¤¾ç¾¤ ${Date.now()}`;
            
            try {
                const response = await fetch(`${API_BASE}/api/v1/guilds`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        name: guildName,
                        description: 'é€™æ˜¯ä¸€å€‹æ¸¬è©¦ç¤¾ç¾¤'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<span class="success">âœ“ å»ºç«‹æˆåŠŸ</span>\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âœ— å»ºç«‹å¤±æ•—</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âœ— éŒ¯èª¤</span>\n${error.message}`;
            }
        }
        
        // æ¸¬è©¦å–å¾—ç¤¾ç¾¤åˆ—è¡¨
        async function testGetGuilds() {
            const resultDiv = document.getElementById('guild-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨å–å¾—ç¤¾ç¾¤åˆ—è¡¨...';
            
            try {
                const response = await fetch(`${API_BASE}/api/v1/guilds/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<span class="success">âœ“ å–å¾—æˆåŠŸ (å…± ${data.guilds?.length || 0} å€‹ç¤¾ç¾¤)</span>\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âœ— å–å¾—å¤±æ•—</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âœ— éŒ¯èª¤</span>\n${error.message}`;
            }
        }
        
        // æ¸¬è©¦ WebSocket
        function testWebSocket() {
            const resultDiv = document.getElementById('ws-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = 'æ­£åœ¨é€£æ¥ WebSocket...\n';
            
            try {
                ws = new WebSocket(`${WS_BASE}/ws?token=${token}`);
                
                ws.onopen = () => {
                    resultDiv.innerHTML += '<span class="success">âœ“ WebSocket é€£æ¥æˆåŠŸ</span>\n';
                    document.getElementById('ws-disconnect-btn').disabled = false;
                    
                    // ç™¼é€ ping
                    setTimeout(() => {
                        const pingMsg = JSON.stringify({
                            type: 'ping',
                            timestamp: Date.now()
                        });
                        ws.send(pingMsg);
                        resultDiv.innerHTML += `\nç™¼é€: ${pingMsg}\n`;
                    }, 1000);
                };
                
                ws.onmessage = (event) => {
                    resultDiv.innerHTML += `\næ¥æ”¶: ${event.data}\n`;
                };
                
                ws.onerror = (error) => {
                    resultDiv.innerHTML += `\n<span class="error">âœ— WebSocket éŒ¯èª¤</span>\n`;
                };
                
                ws.onclose = () => {
                    resultDiv.innerHTML += '\nWebSocket é€£æ¥å·²é—œé–‰\n';
                    document.getElementById('ws-disconnect-btn').disabled = true;
                };
            } catch (error) {
                resultDiv.innerHTML += `<span class="error">âœ— éŒ¯èª¤: ${error.message}</span>\n`;
            }
        }
        
        // æ–·é–‹ WebSocket
        function disconnectWebSocket() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }
        
        // é–‹å•Ÿå‰ç«¯ä»‹é¢
        function openFrontend() {
            window.open('/', '_blank');
        }
        
        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥ä¼ºæœå™¨
        window.onload = () => {
            checkHealth();
        };
    </script>
</body>
</html>
