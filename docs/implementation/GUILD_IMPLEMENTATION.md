# Guild ç®¡ç†ç³»çµ±å¯¦ä½œç¸½çµ

## ğŸ“… å¯¦ä½œæ—¥æœŸ
2024å¹´12æœˆ3æ—¥

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. ç¤¾ç¾¤ç®¡ç†æ ¸å¿ƒåŠŸèƒ½
- âœ… **å»ºç«‹ç¤¾ç¾¤** - ä½¿ç”¨è€…å¯ä»¥å»ºç«‹æ–°ç¤¾ç¾¤ä¸¦è‡ªå‹•æˆç‚ºæ“æœ‰è€…
- âœ… **å–å¾—ç¤¾ç¾¤è©³æƒ…** - æŸ¥è©¢æŒ‡å®šç¤¾ç¾¤çš„å®Œæ•´è³‡è¨Š
- âœ… **åˆ—å‡ºä½¿ç”¨è€…ç¤¾ç¾¤** - åˆ—å‡ºç•¶å‰ä½¿ç”¨è€…æ‰€å±¬çš„æ‰€æœ‰ç¤¾ç¾¤
- âœ… **æ›´æ–°ç¤¾ç¾¤** - ç¤¾ç¾¤æ“æœ‰è€…å¯ä»¥ä¿®æ”¹ç¤¾ç¾¤åç¨±ã€æè¿°ã€åœ–æ¨™
- âœ… **åˆªé™¤ç¤¾ç¾¤** - ç¤¾ç¾¤æ“æœ‰è€…å¯ä»¥åˆªé™¤ç¤¾ç¾¤

### 2. ç¤¾ç¾¤æˆå“¡ç®¡ç†
- âœ… **åŠ å…¥ç¤¾ç¾¤** - ä½¿ç”¨è€…å¯ä»¥åŠ å…¥ä»»ä½•ç¤¾ç¾¤
- âœ… **é›¢é–‹ç¤¾ç¾¤** - æˆå“¡å¯ä»¥é›¢é–‹ç¤¾ç¾¤ï¼ˆæ“æœ‰è€…é™¤å¤–ï¼‰
- âœ… **åˆ—å‡ºæˆå“¡** - æŸ¥çœ‹ç¤¾ç¾¤æ‰€æœ‰æˆå“¡åˆ—è¡¨
- âœ… **è¸¢å‡ºæˆå“¡** - æ“æœ‰è€…å¯ä»¥è¸¢å‡ºå…¶ä»–æˆå“¡
- âœ… **æ›´æ–°è§’è‰²** - æ“æœ‰è€…å¯ä»¥ä¿®æ”¹æˆå“¡è§’è‰²ï¼ˆowner, admin, moderator, memberï¼‰

### 3. æ¬Šé™æ§åˆ¶
- âœ… åªæœ‰ç¤¾ç¾¤æ“æœ‰è€…å¯ä»¥æ›´æ–°/åˆªé™¤ç¤¾ç¾¤
- âœ… åªæœ‰ç¤¾ç¾¤æ“æœ‰è€…å¯ä»¥è¸¢å‡ºæˆå“¡
- âœ… åªæœ‰ç¤¾ç¾¤æ“æœ‰è€…å¯ä»¥ä¿®æ”¹æˆå“¡è§’è‰²
- âœ… æ“æœ‰è€…ç„¡æ³•é›¢é–‹ç¤¾ç¾¤ï¼ˆéœ€å…ˆè½‰ç§»æ‰€æœ‰æ¬Šï¼‰
- âœ… æˆå“¡ä¸èƒ½ä¿®æ”¹è‡ªå·±çš„è§’è‰²
- âœ… æ‰€æœ‰ç«¯é»éƒ½éœ€è¦ JWT èªè­‰

## ğŸ“ æ–°å¢/ä¿®æ”¹çš„æª”æ¡ˆ

### æ–°å¢æª”æ¡ˆ
1. **internal/service/guild_service.go** (342 è¡Œ)
   - `GuildService` ä»‹é¢èˆ‡å¯¦ä½œ
   - `GuildMemberService` ä»‹é¢èˆ‡å¯¦ä½œ
   - æ¥­å‹™é‚è¼¯å±¤ï¼ŒåŒ…å«æ¬Šé™æª¢æŸ¥

2. **internal/handler/guild_handler.go** (354 è¡Œ)
   - `GuildHandler` çµæ§‹é«”
   - 10 å€‹ HTTP ç«¯é»è™•ç†å™¨
   - è«‹æ±‚é©—è­‰èˆ‡éŒ¯èª¤è™•ç†

3. **scripts/test-guild.ps1** (194 è¡Œ)
   - å®Œæ•´çš„ Guild API æ¸¬è©¦è…³æœ¬
   - æ¶µè“‹ 19 å€‹æ¸¬è©¦å ´æ™¯

4. **scripts/quick-test-guild.ps1** (87 è¡Œ)
   - å¿«é€Ÿ Guild API æ¸¬è©¦
   - 8 å€‹æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦

### ä¿®æ”¹æª”æ¡ˆ
1. **internal/server/server.go**
   - æ–°å¢ `guildHandler` æ¬„ä½
   - åˆå§‹åŒ– Guild ç›¸é—œçš„ Repository å’Œ Service
   - è¨»å†Š 10 å€‹ Guild API è·¯ç”±

2. **api/API_GUIDE.md**
   - æ–°å¢ Guild ç®¡ç† API æ–‡ä»¶
   - æ–°å¢ç¤¾ç¾¤æˆå“¡ç®¡ç† API æ–‡ä»¶
   - æ›´æ–°å·²å®ŒæˆåŠŸèƒ½æ¸…å–®
   - æ›´æ–°æ¸¬è©¦çµæœ

## ğŸ”§ æŠ€è¡“å¯¦ä½œç´°ç¯€

### Service å±¤è¨­è¨ˆ
```go
// GuildService - ç¤¾ç¾¤æ ¸å¿ƒæ¥­å‹™é‚è¼¯
type GuildService interface {
    CreateGuild(ownerID uint, req *CreateGuildRequest) (*model.Guild, error)
    GetGuild(guildID uint) (*model.Guild, error)
    ListUserGuilds(userID uint) ([]*model.Guild, error)
    UpdateGuild(guildID, userID uint, req *UpdateGuildRequest) (*model.Guild, error)
    DeleteGuild(guildID, userID uint) error
    IsGuildOwner(guildID, userID uint) (bool, error)
    IsGuildMember(guildID, userID uint) (bool, error)
}

// GuildMemberService - æˆå“¡ç®¡ç†æ¥­å‹™é‚è¼¯
type GuildMemberService interface {
    JoinGuild(guildID, userID uint) error
    LeaveGuild(guildID, userID uint) error
    KickMember(guildID, targetUserID, operatorUserID uint) error
    ListGuildMembers(guildID uint) ([]*model.GuildMember, error)
    GetMember(guildID, userID uint) (*model.GuildMember, error)
    UpdateMemberRole(guildID, targetUserID, operatorUserID uint, role string) error
}
```

### API è·¯ç”±è¨­è¨ˆ
```
POST   /api/v1/guilds                           - å»ºç«‹ç¤¾ç¾¤
GET    /api/v1/guilds                           - åˆ—å‡ºä½¿ç”¨è€…ç¤¾ç¾¤
GET    /api/v1/guilds/:id                       - å–å¾—ç¤¾ç¾¤è©³æƒ…
PUT    /api/v1/guilds/:id                       - æ›´æ–°ç¤¾ç¾¤
DELETE /api/v1/guilds/:id                       - åˆªé™¤ç¤¾ç¾¤
POST   /api/v1/guilds/:id/join                  - åŠ å…¥ç¤¾ç¾¤
POST   /api/v1/guilds/:id/leave                 - é›¢é–‹ç¤¾ç¾¤
GET    /api/v1/guilds/:id/members               - åˆ—å‡ºæˆå“¡
DELETE /api/v1/guilds/:id/members/:userId       - è¸¢å‡ºæˆå“¡
PUT    /api/v1/guilds/:id/members/:userId/role  - æ›´æ–°è§’è‰²
```

### éŒ¯èª¤è™•ç†
å®šç¾©äº†å°ˆç”¨çš„éŒ¯èª¤é¡å‹ï¼š
- `ErrGuildNotFound` - ç¤¾ç¾¤ä¸å­˜åœ¨
- `ErrNotGuildOwner` - éç¤¾ç¾¤æ“æœ‰è€…
- `ErrAlreadyInGuild` - å·²æ˜¯ç¤¾ç¾¤æˆå“¡
- `ErrNotGuildMember` - ä¸æ˜¯ç¤¾ç¾¤æˆå“¡
- `ErrCannotLeaveAsOwner` - æ“æœ‰è€…ç„¡æ³•é›¢é–‹

### è‡ªå‹•åŒ–æ“ä½œ
- å»ºç«‹ç¤¾ç¾¤æ™‚è‡ªå‹•å°‡æ“æœ‰è€…åŠ å…¥ç‚ºæˆå“¡
- åˆªé™¤ç¤¾ç¾¤æ™‚ç´šè¯åˆªé™¤æˆå“¡ï¼ˆç”±è³‡æ–™åº«å¤–éµç´„æŸè™•ç†ï¼‰

## ğŸ§ª æ¸¬è©¦æ¶µè“‹ç¯„åœ

### æ­£å¸¸æµç¨‹æ¸¬è©¦
1. è¨»å†Šä½¿ç”¨è€… â†’ ç™»å…¥ â†’ å»ºç«‹ç¤¾ç¾¤
2. å–å¾—ç¤¾ç¾¤è©³æƒ…
3. åˆ—å‡ºä½¿ç”¨è€…ç¤¾ç¾¤
4. æ›´æ–°ç¤¾ç¾¤è³‡è¨Š
5. ç¬¬äºŒå€‹ä½¿ç”¨è€…åŠ å…¥ç¤¾ç¾¤
6. åˆ—å‡ºç¤¾ç¾¤æˆå“¡
7. æ›´æ–°æˆå“¡è§’è‰²
8. æˆå“¡é›¢é–‹ç¤¾ç¾¤
9. æˆå“¡é‡æ–°åŠ å…¥
10. æ“æœ‰è€…è¸¢å‡ºæˆå“¡
11. æ“æœ‰è€…åˆªé™¤ç¤¾ç¾¤

### éŒ¯èª¤æƒ…æ³æ¸¬è©¦
1. éæ“æœ‰è€…å˜—è©¦æ›´æ–°ç¤¾ç¾¤ â†’ 403 Forbidden
2. éæ“æœ‰è€…å˜—è©¦åˆªé™¤ç¤¾ç¾¤ â†’ 403 Forbidden
3. æ“æœ‰è€…å˜—è©¦é›¢é–‹ç¤¾ç¾¤ â†’ 403 Forbidden
4. é‡è¤‡åŠ å…¥ç¤¾ç¾¤ â†’ 400 Bad Request
5. åˆªé™¤å¾ŒæŸ¥è©¢ç¤¾ç¾¤ â†’ 404 Not Found

## ğŸ“Š ç¨‹å¼ç¢¼çµ±è¨ˆ

- **æ–°å¢ç¨‹å¼ç¢¼**: ~1000 è¡Œ
- **æ¸¬è©¦è…³æœ¬**: ~280 è¡Œ
- **API æ–‡ä»¶**: ~250 è¡Œ
- **ç¸½è¨ˆ**: ~1530 è¡Œ

## ğŸ¯ é–‹ç™¼æ™‚é–“

- è¦åŠƒè¨­è¨ˆ: 10 åˆ†é˜
- ç¨‹å¼ç¢¼å¯¦ä½œ: 40 åˆ†é˜
- æ¸¬è©¦èˆ‡é™¤éŒ¯: 30 åˆ†é˜
- æ–‡ä»¶æ’°å¯«: 20 åˆ†é˜
- **ç¸½è¨ˆ**: ç´„ 100 åˆ†é˜

## ğŸ› é‡åˆ°çš„å•é¡Œèˆ‡è§£æ±º

### 1. Repository æ–¹æ³•åç¨±ä¸ä¸€è‡´
**å•é¡Œ**: Service å±¤ä½¿ç”¨ `GetByGuildAndUser` ä½† Repository å¯¦éš›æ–¹æ³•æ˜¯ `GetMember`

**è§£æ±º**: çµ±ä¸€ä¿®æ”¹ Service å±¤èª¿ç”¨æ­£ç¢ºçš„ Repository æ–¹æ³•

### 2. è·¯ç”±é…ç½®èªæ³•éŒ¯èª¤
**å•é¡Œ**: server.go ä¸­è·¯ç”±é…ç½®æœ‰å¤šé¤˜çš„å¤§æ‹¬è™Ÿå’Œç¼ºå°‘é–‰åˆæ‹¬è™Ÿ

**è§£æ±º**: é‡æ–°æ•´ç† setupRoutes å‡½æ•¸ï¼Œç¢ºä¿æ‹¬è™Ÿé…å°æ­£ç¢º

### 3. Docker å®¹å™¨æœªå•Ÿå‹•
**å•é¡Œ**: æ¸¬è©¦æ™‚ç™¼ç¾ PostgreSQL é€£æ¥å¤±æ•—

**è§£æ±º**: å•Ÿå‹• Docker Desktop å’Œ docker-compose å®¹å™¨

## âœ¨ äº®é»ç‰¹è‰²

1. **å®Œæ•´çš„æ¬Šé™æ§åˆ¶ç³»çµ±** - ä¸åŒè§’è‰²æœ‰ä¸åŒçš„æ“ä½œæ¬Šé™
2. **åŸå­æ€§æ“ä½œ** - å»ºç«‹ç¤¾ç¾¤æ™‚è‡ªå‹•åŠ å…¥æˆå“¡ï¼Œåˆªé™¤å¤±æ•—æœƒå›æ»¾
3. **æ¸…æ™°çš„éŒ¯èª¤è¨Šæ¯** - æ¯å€‹éŒ¯èª¤æƒ…æ³éƒ½æœ‰æ˜ç¢ºçš„éŒ¯èª¤å›æ‡‰
4. **å…¨é¢çš„æ¸¬è©¦è¦†è“‹** - åŒ…å«æ­£å¸¸æµç¨‹å’Œç•°å¸¸æƒ…æ³
5. **è©³ç´°çš„ API æ–‡ä»¶** - åŒ…å«è«‹æ±‚/å›æ‡‰ç¯„ä¾‹å’ŒéŒ¯èª¤èªªæ˜

## ğŸ”œ å¾ŒçºŒæ”¹é€²å»ºè­°

1. **ç¤¾ç¾¤é‚€è«‹ç³»çµ±**
   - é‚€è«‹ç¢¼ç”Ÿæˆ
   - ç§æœ‰/å…¬é–‹ç¤¾ç¾¤è¨­å®š
   - é‚€è«‹é€£çµç®¡ç†

2. **æˆå“¡æ¬Šé™ç´°åŒ–**
   - è‡ªè¨‚è§’è‰²
   - æ¬Šé™çµ„åˆé…ç½®
   - ç¹¼æ‰¿æ¬Šé™ç³»çµ±

3. **ç¤¾ç¾¤çµ±è¨ˆ**
   - æˆå“¡æ•¸é‡çµ±è¨ˆ
   - æ´»èºåº¦åˆ†æ
   - è¨Šæ¯é‡çµ±è¨ˆ

4. **ç¤¾ç¾¤è¨­å®š**
   - å…¬å‘Šç³»çµ±
   - é©—è­‰ç´šåˆ¥
   - å…§å®¹éæ¿¾

5. **æ‰€æœ‰æ¬Šè½‰ç§»**
   - è½‰ç§»æ‰€æœ‰æ¬ŠåŠŸèƒ½
   - è½‰ç§»ç¢ºèªæµç¨‹

## ğŸ“ å°çµ

Guild ç®¡ç†ç³»çµ±å·²å®Œæ•´å¯¦ä½œï¼ŒåŒ…å«æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å’Œæ¬Šé™æ§åˆ¶ã€‚æ‰€æœ‰ API ç«¯é»éƒ½ç¶“éæ¸¬è©¦é©—è­‰ï¼Œæ–‡ä»¶å®Œæ•´ã€‚

ä¸‹ä¸€æ­¥å»ºè­°é–‹ç™¼ï¼š
1. **é »é“ç®¡ç†ç³»çµ±** (Channel Management)
2. **è¨Šæ¯ç³»çµ±** (Message System)
3. **WebSocket å³æ™‚é€šè¨Š** (Real-time Communication)

---

**å¯¦ä½œè€…**: GitHub Copilot
**å°ˆæ¡ˆ**: TalkRealm - Discord-like Instant Messaging Platform
**ç‰ˆæœ¬**: v0.2.0
